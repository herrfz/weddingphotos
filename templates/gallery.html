<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Gallery</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="full-page-container gallery-container">
        <div class="swipe" id="swipeArea"></div>

        {% for file in files %}
        <div class="media-item {% if loop.index == 1 %}active{% endif %}">
            {% if file.split('.')[-1] in ['png', 'jpg', 'jpeg', 'gif', 'heic', 'heif'] %}
            <img src="{{ url_for('uploaded_file', filename=file) }}" alt="image" class="media-item">
            {% elif file.split('.')[-1] in ['mp4', 'mov', 'avi'] %}
            <video controls class="media-item">
                <source src="{{ url_for('uploaded_file', filename=file) }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <script>
        let currentIndex = 0;
        const mediaItems = document.getElementsByClassName('media-item');

        function showMedia(index) {
            mediaItems[currentIndex].classList.remove('active');
            currentIndex = (index + mediaItems.length) % mediaItems.length;
            mediaItems[currentIndex].classList.add('active');
        }

        function handleSwipe(direction) {
            if (direction === 'up') {
                showMedia(currentIndex + 1);
            } else if (direction === 'down') {
                showMedia(currentIndex - 1);
            } else if (direction === 'left') {
                window.location.href = '/';
            }
        }

        let touchstartY = 0;
        let touchendY = 0;
        let touchstartX = 0;
        let touchendX = 0;

        document.getElementById('swipeArea').addEventListener('touchstart', function (event) {
            touchstartY = event.changedTouches[0].screenY;
            touchstartX = event.changedTouches[0].screenX;
        }, false);

        document.getElementById('swipeArea').addEventListener('touchend', function (event) {
            touchendY = event.changedTouches[0].screenY;
            touchendX = event.changedTouches[0].screenX;
            handleSwipeGesture();
        }, false);

        function handleSwipeGesture() {
            let yDiff = touchstartY - touchendY;
            let xDiff = touchstartX - touchendX;

            if (Math.abs(yDiff) > Math.abs(xDiff)) {
                if (yDiff > 0) {
                    handleSwipe('up');
                } else {
                    handleSwipe('down');
                }
            } else {
                if (xDiff > 0) {
                    handleSwipe('left');
                }
            }
        }

        document.addEventListener('keydown', function (event) {
            if (event.key === 'ArrowUp') {
                handleSwipe('up');
            } else if (event.key === 'ArrowDown') {
                handleSwipe('down');
            } else if (event.key === 'Escape') {
                window.location.href = '/';
            }
        });
    </script>
</body>

</html>